# chainai — Agent Skill Reference

## Overview

`chainai` is a CLI tool distributed as an npm package. It is invoked via `npx chainai@latest`. This document defines the tool's interface, expected behaviors, and message contracts for AI agent consumption.

## Invocation

```
npx chainai@latest [options]
```

- **Runtime**: Node.js (>=18)
- **Package manager**: yarn (v4)
- **Entry point**: `dist/index.js`

## Exit Codes

| Code | Meaning                                                            |
| ---- | ------------------------------------------------------------------ |
| `0`  | Operation completed successfully.                                  |
| `1`  | Operation failed. Inspect `stderr` for a structured error message. |

## Message Contract

All output is written to `stdout` (success) or `stderr` (errors). Messages are designed for programmatic parsing by AI agents.

### Success Messages

Success messages are written to `stdout`. Agents should parse `stdout` to determine the result of the operation.

| Message                     | Meaning                                                                                                 |
| --------------------------- | ------------------------------------------------------------------------------------------------------- |
| `CHAINAI_OK: <description>` | The requested operation completed successfully. `<description>` contains a brief summary of the result. |

### Error Messages

Error messages are written to `stderr` and follow a structured format:

```
CHAINAI_ERR: <ERROR_CODE> — <description>
```

| Error Code         | Description                                                                                                                                                    |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `INVALID_INPUT`    | The provided input is malformed or missing required fields. The agent should re-validate input parameters and retry.                                           |
| `EXECUTION_FAILED` | The operation could not be completed. The description contains details on the failure cause. The agent should inspect the description and adjust its approach. |
| `TIMEOUT`          | The operation exceeded the allowed time limit. The agent should retry with a longer timeout or simplify the request.                                           |
| `UNKNOWN`          | An unexpected error occurred. The agent should report this to the orchestrator for manual inspection.                                                          |

## Agent Integration Guidelines

1. **Always use the latest version**: Invoke with `npx chainai@latest` to ensure the most recent release is used.
2. **Parse stdout for results**: Successful output is always written to `stdout`. Do not rely on exit code alone — read and parse `stdout`.
3. **Parse stderr for errors**: On non-zero exit codes, read `stderr` for a structured error message beginning with `CHAINAI_ERR:`.
4. **Retry strategy**: For `TIMEOUT` and `EXECUTION_FAILED` errors, retry up to 2 times with exponential backoff before escalating.
5. **Do not prompt for user input**: This tool is non-interactive. All required parameters must be passed as arguments or flags.

## Development

| Command             | Purpose                                         |
| ------------------- | ----------------------------------------------- |
| `yarn build`        | Compile TypeScript source to `dist/`.           |
| `yarn dev`          | Run the CLI directly from source via `ts-node`. |
| `yarn format`       | Format all source files with Prettier.          |
| `yarn format:check` | Verify formatting without modifying files.      |
| `yarn clean`        | Remove the `dist/` directory.                   |

## Project Structure

```
src/
  index.ts        # CLI entry point (#!/usr/bin/env node)
dist/             # Compiled output (generated by `yarn build`)
tsconfig.json     # TypeScript configuration
.prettierrc       # Prettier configuration
package.json      # Package manifest with bin, scripts, and metadata
agents.md         # This file — agent skill reference
```
